<!doctype html>
<html>
<head>
	<title data-l10n-id="home.serverName">连星</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<link rel="shortcut icon" href="/favicon.ico">
    
    <link href="../static/bootstrap-3.2.0-dist/css/bootstrap.min.css" rel="stylesheet">
	<link href="../static/flat-ui-dist/css/flat-ui.min.css" rel="stylesheet">
    <link href="../static/css/common-setting.css" rel="stylesheet">
    <link href="../static/css/insidePageSetting.css" rel="stylesheet">
    <link href="../static/css/subfieldLayout.css" rel="stylesheet">
    <link href="../static/css/padDetail.css" rel="stylesheet">
    <link href="../static/css/userGroups.css" rel="stylesheet">
</head>

<body>
	<div id="header">
    	<div class="container dispace-1">
        	<span id="welcome">欢迎来到连星</span>&nbsp;&nbsp;
            <span id="introduce">实时互动教学网站</span>
            <div class="btn-group detailGroup pull-right userinfo">
            	<a data-toggle="dropdown" href="#"><img src="../pic/user.png"></a>
                <ul role="menu" class="dropdown-menu userdropdown">
                	<li><a href="#"><span class="fui-user"></span> uiop0009</a></li>
                    <li><a href="#"><span class="fui-gear"></span> 账号设置</a></li>
                    <li><a href="#"><span class="fui-exit"></span> 退出</a></li>
                </ul>
            </div>
            <a class="pull-right notice" href="/user/messages" title="通知"><span class="glyphicon glyphicon-bullhorn"></span> <span id="noticeNum">&nbsp;&nbsp;</span></a>
            
        </div>   
    </div>
    <!--主菜单-->
    <div class="drawShadow">
    <div class="container dispace-1">
    	<nav class="navbar navbar-defind" role="navigation">
        	<div class="navbar-header">
            	<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainMenu"></button>
                <a class="navbar-brand-defind" href="/user"><span class="glyphicon glyphicon-send" id="send"></span><span id="logotitle">连 星</span></a>
            </div>
            <div class="collapse navbar-collapse" id="mainMenu">
            	<ul class="nav navbar-nav mainOption">
                	<li><a class="grey" href="/user">&nbsp; 我 &nbsp;</a></li>
                    <li><a class="grey" href="/user/contacts">联系人</a></li>
                    <li class="active"><a class="grey" href="/user/userGroups">小组</a></li>
                    <li><a class="grey" href="/user/pads">文档</a></li>
                    <li><a class="grey" href="/user/slides">幻灯片</a></li>
                </ul>
                <form class="navbar-form navbar-right" id="searchform" action="#" role="search">
                	<div class="form-group">
                    	<div class="input-group">
                        	<input class="form-control" id="searchBox" type="search" placeholder="用户/小组">
                            <span class="input-group-btn">
                            	<button type="submit" class="btn" id="searchBtn"><span class="fui-search"></span></button>
                            </span>
                        </div>
                    </div>
                </form>
            </div>
        </nav>
    </div>
    </div>
    
    <div class="container dispace-2">
    	<div class="row">
        	<div class="col-sm-8 col-xs-7">
    			<p class="standard-title">我的组(<span id="groupsNum">0</span>)</p>
            </div>
            <div class="col-sm-4 col-xs-5">
            	<div class="pull-right" id="addnewItem">
                	<input type="text" placeholder="组名" class="form-control inputnameframe" id="inputItemTitle">
                    <button class="btn btn-newItem" type="button" id="inputnewItem">创建组</button>
                </div>
            </div>
        </div>
        <div id="contactsArea">
        	
        </div>
        <div class="center" id="pagechange">
        	<a class="fui-arrow-left" id="prebtn"></a>
            <div id="pagebtn"></div>
            <a class="fui-arrow-right" id="nextbtn"></a>
        </div>
        
    </div>
    
    
    
    
    <div class="footer">
    	<a href="#"><span class="glyphicon glyphicon-send"></span> 连星 @ Copyright by www.hepea.net</a>
    </div>
    
    <!--黑背景-->
    <div id="blackBackground" class="hide">
    </div>
    <!--创建组弹窗-->
    <div id="docSetting" class="addwindow">
    	<p class="standard-title windowtitle">创建新组</p>
        <div class="contentframe">
        	<div class="row">
        		<div class="col-sm-3 col-xs-5">
            		<span class="boldtitle">组名：</span>
            	</div>
            	<div class="col-sm-9 col-xs-7">
            		<input type="text" class="form-control" id="changeDocTitle">
            	</div>
        	</div>
            <div class="row" id="IconSetArea">
        		<div class="col-sm-3 col-xs-5">
            		<span class="boldtitle">组图标：</span>
            	</div>
            	<div class="col-sm-9 col-xs-7" id="settingContent">
            	</div>
            </div>
        </div>
        <div id="closeDocSetting" class="closebtn">
            <span class="fui-cross"></span>
        </div>
        <button type="button" class="btn btn-primary confirmBtn" id="sharegroupbtn">创建组</button>
    </div>
            
    
    <script type="text/javascript" src="../static/js/promise.js"></script>
	<script type="text/javascript" src="../static/js/ajax.js"></script>
	<script type="text/javascript" src="../static/js/jquery-1.11.1.min.js"></script>
    <script type="text/javascript" src="../static/flat-ui-dist/js/flat-ui.min.js"></script>
    
    <script type="text/javascript">
		$(function(){
			$('.input-group').on('focus', '.form-control', function () {
      				$(this).closest('.input-group, .form-group').addClass('focus');
    			}).on('blur', '.form-control', function () {
      				$(this).closest('.input-group, .form-group').removeClass('focus');
    			});
			
			$('.detailGroup').each(function(index, element) {
                    $(this).hover(function(){
							clearTimeout(window['t'+index]);
							$(this).addClass('open');
						},function(){
							var $this = $(this);
							window['t'+ index]=setTimeout(function(){$this.removeClass('open');},200);
					});
                });
			
			var contactsArea = $('#contactsArea');
			var pagebtn = $('#pagebtn');
			var lastclick = ' ';
			var curclick = ' ';
			var curN = 1; //当前播放的分页
			var blackBack = $('#blackBackground');
			var data = [8,
			{imgurl: '../pic/lanxiang.png',groupid:'7bVuYIwacOXU4jia',groupname:'蓝翔技校',doc:'xiaofeiji',docid:'vbCqAP7IQQxI5OJH',creator:'1'},
			{imgurl: '../pic/guangchangwu.png',groupid:'7bVuYIwacOXU4jia',groupname:'广场舞研究院',doc:'小苹果',docid:'vbCqAP7IQQxI5OJH'},
			{groupid:'7bVuYIwacOXU4jia',groupname:'编程爱好者',doc:'java进阶高级...',docid:'vbCqAP7IQQxI5OJH'},
			{groupid:'7bVuYIwacOXU4jia',groupname:'钢琴大师班',doc:'钢琴八级考试...',docid:'vbCqAP7IQQxI5OJH'},
			{imgurl: '../pic/zuojiaxiehui.png',groupid:'7bVuYIwacOXU4jia',groupname:'作家协会',doc:'现代写作导论',docid:'vbCqAP7IQQxI5OJH',creator:'1'},
			{groupid:'7bVuYIwacOXU4jia',groupname:'设计家',doc:'扁平化设计风...',docid:'vbCqAP7IQQxI5OJH'},
			{imgurl: '../pic/chuyi.png',groupid:'7bVuYIwacOXU4jia',groupname:'厨艺坊',doc:'淮扬菜系推广',docid:'vbCqAP7IQQxI5OJH'},
			{groupid:'7bVuYIwacOXU4jia',groupname:'剪刀石头布',doc:'猜拳胜率分析',docid:'vbCqAP7IQQxI5OJH'}
			];
			
			var datalength = data.length;
			$('#groupsNum').html(data[0]);
			
			paging();
			
			function resizeWindow(){
				if($(window).width() >= 975){
					contactsArea.html('<div class="cell3-left"><div class="cellContent"></div></div><div class="cell3-middle"><div class="cellContent"></div></div><div class="cell3-right"><div class="cellContent"></div></div>');
				}
				else if($(window).width() >= 570) {
					contactsArea.html('<div class="cell2-left"><div class="cellContent"></div></div><div class="cell2-right"><div class="cellContent"></div></div>');
				}
				else {
					contactsArea.html('<div class="cell1"><div class="cellContent"></div></div>');
				}
				contactsShow();
				blackBack.css('height',$(document.body).height());
			}
			resizeWindow();
			$(window).resize(resizeWindow);
			
			
			function paging(){//分页
				var contactnum = datalength-1;
				var pagenum = Math.ceil(contactnum/24);
				var htmltext = '';
				for(n = 1; n <= pagenum; n++){
					htmltext += '<a id="pagebtn'+n+'"></a>';
					window['pageArray'+n] = [];
					var arr = window['pageArray'+n];
					for(i = 1; i < 25; i++){
						var id = 24*(n-1)+i;
						if(id < datalength){
							arr.push(id);
						}
						else {
							break;
						}
					}
				}
				pagebtn.html(htmltext);
				for(n = 1; n <= pagenum; n++){
					$('#pagebtn'+n).click({id: n},pagebtnclick);
				}
				$('#prebtn').click(function(){
					var btnid = (curN-1)>0 ? (curN-1) : pagenum;
					$('#pagebtn'+btnid).click();
				});
				$('#nextbtn').click(function(){
					var btnid = (curN+1)<=pagenum ? (curN+1) : 1;
					$('#pagebtn'+btnid).click();
				});
				$('#pagebtn1').click();
			}
			
			function pagebtnclick(e){
				lastclick = curclick;
				curclick = this;
				curN = e.data.id;
				if(curclick != lastclick){
					$(lastclick).removeClass('active');
					$(this).addClass('active');
					contactsShow();
				}
			}
			function contactsShow(){ //分页展示刷新
				var arr = window['pageArray'+curN];
				var cellContent = $('.cellContent');
				var cyclength = cellContent.length;
				var cycid = 0;
				var date = new Date().getTime();
				cellContent.each(function(){
					$(this).html('');
				});
				$.each(arr,function(n,value){
					var imgurl = data[value].imgurl;
					if(!imgurl){
						imgurl = '../pic/groupdefaultpic.png';
					}
					var htmltext = $(cellContent[cycid]).html();
					
					if(data[value].creator) {
						htmltext += '<div groupid="'+data[value].groupid+'" class="listItem"><img src="'+imgurl+'" class="itempic pull-left"><p class="itemTitle">'+data[value].groupname+'<img src="../pic/groupCreatorTab.png" class="creatTab"></p><p class="profile">最新添加文档：<a href="/userGroup/'+data[value].docid+'" target="_blank">'+data[value].doc+'</p></div>';
					}
					else {
						htmltext += '<div groupid="'+data[value].groupid+'" class="listItem"><img src="'+imgurl+'" class="itempic pull-left"><p class="itemTitle">'+data[value].groupname+'</p><p class="profile">最新添加文档：<a href="/userGroup/'+data[value].docid+'" target="_blank">'+data[value].doc+'</p></div>';
					}
					$(cellContent[cycid]).html(htmltext);
					if(++cycid >= cyclength){
						cycid = 0;
					}
				});
				addhref();
			}
			function addhref(){//附上链接
				$('.listItem').each(function(index, element) {
                    var This = $(this);
					This.children('.itemTitle').click(function(){
						var target = '/padDetail/'+This.attr('groupid');
						window.open(target);
					});
                });
			}
			
			
			var inputnewItem = $('#inputnewItem');
			var inputItemTitle = $('#inputItemTitle');
			var docSetting = $('#docSetting');
			var changeDocTitle = $('#changeDocTitle');
			var closeDocSetting = $('#closeDocSetting');
			var settingContent = $('#settingContent');
			var lastActive;
			var newActive;
			
			function newWindowInit(){
				inputnewItem.click(function(){
					blackBack.removeClass('hide');
					var THIS = this;
					replaceSetting(THIS);
					docSetting.css({'transform':'scale(1,1)'});
				});
				closeDocSetting.click(closewindow);
				blackBack.click(closewindow);
			}
			newWindowInit();
			function closewindow(){
				blackBack.addClass('hide');
				docSetting.css({'transform':'scale(0,0)'});
			}
			
			var defaultTail = '<div class="iconOption pull-left" id="userDefinedIcon"><img src="../pic/plus.png" class="iconOptionImg userDefinedImg"><br>自定义</div>';
			function replaceSetting(THIS){
				//此处需补充请求数据方法
				changeSettingContent();
			}
			var setdata = [{id:'默认图标',url:'../pic/groupdefaultlg.png'},{id:'自定义图标1',url:'../pic/luxun.png'},{id:'自定义图标2',url:'../pic/pugongying.png'}];
			
			function changeSettingContent(){
				changeDocTitle.val(inputItemTitle.val());
				var htmltext = '';
				$.each(setdata,function(n,obj){
					htmltext += '<div class="iconOption pull-left iconOptionMember"><span class="fui-check-circle activeIcon hide"></span><img src="'+obj.url+'" class="iconOptionImg"><br>'+obj.id+'</div>';
				});
				htmltext += defaultTail;
				settingContent.html(htmltext);
				
				var iconOptMer = $('.iconOptionMember');
				iconOptMer.each(function(index, element) {
                    var This = $(this);
					This.click(function(){
						if(This != newActive) {
							This.addClass('iconActive');
							This.children('.activeIcon').removeClass('hide');
							lastActive = newActive;
							newActive = This;
							if(lastActive){
								lastActive.removeClass('iconActive');
								lastActive.children('.activeIcon').addClass('hide');
							}
						}
					});
                });
				iconOptMer[0].click();
			}
			
		});
	</script>
</body>
</html>
